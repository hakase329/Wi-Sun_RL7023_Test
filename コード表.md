# 知っておく必要があるコード類
- 低圧スマート電力量メーターからデータを取得するのに必要な各種コード類のメモ
- 詳細はECHONETの仕様書を確認

## 電文構成

| 形式１ |> |> |> |> |> |> |> |> | 
| --- | --- | --- | --- | --- | --- | --- | --- | --- | 
| EHD | TID | SEOJ | DEOJ | ESV | OPC | EPC | PDC | EDT | 

- OPCの指定次第ではEPC1,PDC1,EDT1,EPC2,PDC2,EDT2,EPCn,PDCn,EDTnのようになる

## EHDコード
- EHD = ECHONET Lite ヘッダ
    - 2 byte (EHD1 = 1 byte,EHD2 = 1 byte)

- ECHONETのプロトコル種別を指定する ECHONET Lite ヘッダ１（EHD１）<br>
とEDATA部の電文形式を指定する ECHONET Lite ヘッダ 2（EHD2）で構成される

- EHD1

    - ECHONET Liteでは「0x10」固定

- EHD2
    - 基本的には「0x81」になるはず

 | code   | 用途     |
 | ------ | -------- |
 | 0x81   | ECHONET Lite規格書に記載された電文形式 |
 | 0x82   | 任意電文形式 |
 | その他 | future reserved |

## TID
- TID = トランザクションID
    - 2 byte
- 送信時に指定したものが受信時に返ってくる
- 1対1の通信の場合は何でも良い

## SEOJ
- SEOJ = 送信元ECHONET Liteオブジェクト指定
    - 3 byte
- APPENDIX ECHONET機器オブジェクト詳細規定に記載された機器のクラスグループコード・クラスコード・インスタンスコードを繋いだものを記載する
- ラズパイに挿したUSBドングルであれば<br>コントローラクラス = `0x05,0xFF,0x01` を指定すればよい

## DEOJ
- DEOJ = 相手先ECHONET Liteオブジェクト指定
    - 3 byte
- 選定方法はSEOJと同様
- 低圧スマート電力量メーターであれば<br>低圧スマート電力量メーター = `0x02,0x88,0x01=` を指定すればよい

## ESVコード
- ESV = ECHONET Lite サービスコード
    - 1 byte

### 要求用 ESV コード一覧
| ESV code  | ECHONET Lite サービス内容            | 記号    | 備考         |
| --------- | ------------------------------------ | ------- | ------------ |
| 0x60      | プロパティ値書き込み要求（応答不要） | SetI    | 一斉同報可   |
| 0x61      | プロパティ値書き込み要求（応答要）   | SetC    |              |
| 0x62      | プロパティ値読み出し要求             | Get     | 一斉同報可   |
| 0x63      | プロパティ値通知要求                 | INF_REQ | 一斉同報可   |
| 0x64-0x6D | for future reserved                  |         |              |
| 0x6E      | プロパティ値書き込み・読み出し要求   | SetGet  | 一斉同報可   |
| 0x6F      | for future reserved                  |         |              |

- ECHONET Lite 通信ミドルウェア仕様.pdf 表 ３-９ 要求用 ESV コード一覧表 より

### 応答・通知用 ESV コード一覧
| ESV code  | ECHONET Lite サービス内容              | 記号       | 備考                          |
| --------- | -------------------------------------- | ---------- | ----------------------------- |
| 0x71      | プロパティ値書き込み応答               | Set_Res    | ESV=0x61 の応答、個別応答     |
| 0x72      | プロパティ値読み出し応答               | Get_Res    | ESV=0x62 の応答、個別応答     |
| 0x73      | プロパティ値通知                       | INF        | 個別通知、一斉同報通知共に可(自発的なプロパティ値通知、及び、0x63 の応答に使用) |
| 0x74      | プロパティ値通知（応答要）             | INFC       | 個別通知                      |
| 0x75-0x79 | for future reserved                    |            |                               |
| 0x7A      | プロパティ値通知応答                   | INFC_Res   | ESV=0x74 の応答、個別応答     |
| 0x7B-0x7D | for future reserved                    |            |                               |
| 0x7E      | プロパティ値書き込み・読み出し応答     | SetGet_Res | ESV=0x6E の応答、個別応答     |
| 0x7F      | for future reserved                    |            |                               |
| 0x50      | プロパティ値書き込み要求不可応答       | SetI_SNA   | ESV=0x60 の不可応答、個別応答 |
| 0x51      | プロパティ値書き込み要求不可応答       | SetC_SNA   | ESV=0x61 の不可応答、個別応答 |
| 0x52      | プロパティ値読み出し不可応答           | Get_SNA    | ESV=0x62 の不可応答、個別応答 |
| 0x53      | プロパティ値通知不可応答               | INF_SNA    | ESV=0x63 の不可応答、個別応答 |
| 0x54-0x5D | for future reserved                    |            |                               |
| 0x5E      | プロパティ値書き込み・読み出し不可応答 | SetGet_SNA | ESV=0x6E の不可応答、個別応答 |
| 0x5F      | for future reserved                    |            |                               |

- ECHONET Lite 通信ミドルウェア仕様.pdf 表 ３-１０ 応答・通知用 ESV コード一覧表 より

## OPC
- OPC = 処理プロパティ数
    - 1 byte
- 今回依頼する処理数(EPC,PDC,EDT 1セットで1)を記載する

## EPCコード一覧
- EPC = ECHONET プロパティコード
    - 1 byte

### 低圧スマート電力量メーター用 ECHONET プロパティ(EPC)
- グループコード     : 0x02
- クラスコード       : 0x88
- インスタンスコード : 0x01

| EPC code | プロパティ名                        | サイズ   | 搭載値域 |
| -------- | ----------------------------------- | -------- | -------------------------- |
| 0x80     | 動作状態                            |   1 byte | ON=0x30、OFF=0x31          |
| 0x81     | 設置場所                            |  17 byte |                            |
| 0x82     | 規格 Version 情報                   |   4 byte |                            |
| 0x88     | 異常発生状態                        |   1 byte | 異常有=0x41、異常無=0x42   |
| 0x8A     | メーカコード                        |   3 byte |                            |
| 0x8D     | 製造番号                            |  12 byte |                            |
| 0x97     | 現在時刻設定                        |   2 byte | hh:mm                      |
| 0x98     | 現在年月日設定                      |   4 byte | YYYY:MM:DD                 |
| 0x9D     | 状変アナウンスプロパティマップ      |  17 byte |                            |
| 0x9E     | Set プロパティマップ                |  17 byte |                            |
| 0x9F     | Get プロパティマップ                |  17 byte |                            |
| 0xD3     | 係数                                |   4 byte |                            |
| 0xD7     | 積算電力有効桁数                    |   1 byte |                            |
| 0xE0     | 積算電力量計測値(正方向計測値)      |   4 byte |                            |
| 0xE1     | 積算電力量単位                      |   1 byte | 0.1kWh=0x01、0.01kWh=0x02  |
| 0xE2     | 積算電力量計測値履歴1               | 194 byte |                            |
| 0xE3     | 積算電力量計測値（逆方向計測値)     |   4 byte |                            |
| 0xE4     | 積算電力量計測値履歴1(逆方向計測値) | 194 byte |                            |
| 0xE5     | 積算履歴収集日1                     |   1 byte |                            |
| 0xE7     | 瞬時電力計測値                      |   4 byte | 1W 単位                    |
| 0xE8     | 瞬時電流計測値                      |   4 byte | 0.1A 単位でR相T相の計測値が入る(2byteずつ処理) |
| 0xEA     | 定時積算電力量計測値（正方向計測値) |  11 byte |                            |
| 0xEB     | 定時積算電力量計測値(逆方向計測値)  |  11 byte |                            |
| 0xEC     | 積算電力量計測値履歴1(正方向,逆方向)| 103 byte |                            |
| 0xED     | 積算履歴収集日2                     |   7 byte |                            |

- APPENDIX ECHONET機器オブジェクト詳細規定Release Q.pdf ３．３．２５ 低圧スマート電力量メータクラス規定 より

## PDC
- PDC = EDTのバイト数
    - 1 byte
- 読み出し要求の場合不要(0x00とかではなくnull)

## EDT
- EDT = プロパティ値データ
    - 任意(PDCで指定のbyte数)
- 読み出し要求の場合不要(0x00とかではなくnull)
